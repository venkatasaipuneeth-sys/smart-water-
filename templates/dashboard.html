<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Water Quality Monitoring</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="/static/js/dashboard.js"></script>
</head>
<body>
    <nav class="navbar">
        <span class="navbar-brand">Water Quality Monitoring</span>
        <span class="navbar-user">Logged in as: {{ session['username'] }}</span>
        <a href="/logout" class="navbar-logout">Logout</a>
        <span class="navbar-info" onclick="showInfo()">ℹ️</span>
    </nav>
    <div class="container">
        <h2>Data Entry Dashboard</h2>
        <form id="dataEntryForm" method="POST" enctype="multipart/form-data" action="/submit">
            <button type="button" onclick="detectLocation()">Detect Location</button>
            <input type="text" id="latitude" name="latitude" placeholder="Latitude" readonly required>
            <input type="text" id="longitude" name="longitude" placeholder="Longitude" readonly required>
            <div id="map" style="height: 200px;"></div>
            <select name="water_type" required>
                <option value="">Select Water Type</option>
                <option>Open Ocean Water</option>
                <option>Coastal Water</option>
                <option>Estuarine Water</option>
                <option>Deep Sea Water</option>
                <option>Marine Surface Water</option>
                <option>Pond Water</option>
                <option>Drinking Water</option>
                <option>Ground Water</option>
            </select>
            <input type="text" name="pin_id" placeholder="Example: POND_01, OCEAN_02" required>
            <button type="button" onclick="scanBLE()">Scan & Connect to ESP32</button>
            <span id="bleStatus">Not Connected</span>
            <button type="button" onclick="readSensorData()">Read Sensor Data</button>
            <div id="sensorFields">
                <input type="text" name="temperature" placeholder="Temperature" readonly>
                <input type="text" name="pH" placeholder="pH" readonly>
                <input type="text" name="DO" placeholder="DO" readonly>
                <input type="text" name="TDS" placeholder="TDS" readonly>
                <input type="text" name="chlorophyll" placeholder="Chlorophyll" readonly>
                <input type="text" name="TA" placeholder="TA" readonly>
                <input type="text" name="DIC" placeholder="DIC" readonly>
            </div>
            <input type="file" name="image" accept="image/*" required>
            <input type="hidden" name="date" id="dateField">
            <input type="hidden" name="time" id="timeField">
            <button type="submit">Submit Data</button>
        </form>
        <div id="confirmation" style="display:none;">Data saved successfully</div>
    </div>
    <div id="infoModal" style="display:none;">
        <h4>User Activity</h4>
        <p>Visits: {{ user.visit_count }}</p>
        <p>Last visit: {{ user.last_login_date }} | {{ user.last_login_time }}</p>
        <button onclick="closeInfo()">Close</button>
    </div>
</body>
</html>
